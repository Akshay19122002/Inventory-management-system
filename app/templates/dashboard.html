{% extends "base.html" %} {% block content %}
<h2>Welcome, {{ current_user.name }}</h2>
<p>Role: <strong>{{ current_user.role }}</strong></p>

{% if current_user.role == 'admin' %}
<a href="{{ url_for('products.create') }}" class="btn btn-primary"
  >Add Product</a
>
<a href="{{ url_for('logs.view') }}" class="btn btn-secondary">View Logs</a>
{% endif %}

<table>
  <thead>
    <tr>
      <th>SKU</th>
      <th>Name</th>
      <th>Stock</th>
      <th>Expiry</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for product in products %}
    <tr
      class="{% if product.stock <= product.threshold %}low-stock-row{% endif %}"
    >
      <td>{{ product.sku }}</td>
      <td>{{ product.name }}</td>
      <td>
        {{ product.stock }} {% if product.stock <= product.threshold %}
        <span class="badge low-stock">Low</span>
        {% endif %}
      </td>
      <td>{{ product.expiry_date or 'â€”' }}</td>
      <td>
        {% if current_user.role == 'admin' %}
        <a href="{{ url_for('products.edit', product_id=product.id) }}">Edit</a>
        |
        <a href="{{ url_for('products.delete', product_id=product.id) }}"
          >Delete</a
        >
        {% else %}
        <a href="{{ url_for('stock.sale', product_id=product.id) }}">Sale</a> |
        <a href="{{ url_for('stock.return_', product_id=product.id) }}"
          >Return</a
        >
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
